要件定義書 - blog-masa86
1. プロジェクト概要
目的
masa86.comの雑記ブログを、Next.jsフルスタックで堅牢・高速・長期運用可能に再構築
基本情報
プロジェクト名: blog-masa86
URL: https://blog.masa86.com
運用期間: 長期（30年目標）
開発方針: クリーンな設計、堅牢性、安定性を最優先
設計思想
ミニマル: 装飾を排し、テキストと情報に集中
可読性: 読みやすいタイポグラフィと適切な余白
操作性: 直感的なナビゲーション、高速なページ遷移
安定性: 枯れた技術、シンプルな実装、長期保守性
2. 技術スタック（安定版重視）
フロントエンド・バックエンド
フレームワーク: Next.js 14.2（App Router）
ランタイム: React 18.3
言語: TypeScript 5
スタイリング: Tailwind CSS 3.4 + Custom CSS
インフラ（Cloudflare）
ホスティング: Cloudflare Pages
データベース: Cloudflare D1（SQLite）
ランタイム戦略:
UIページ: Node.js runtime（リンク機能優先）
APIルート: 必要に応じてEdge runtime（ただし極力Nodeで）
ビルドツール: @cloudflare/next-on-pages
重要な設計方針（post-masa86の失敗からの教訓）
✅ 採用する原則:
Next.js 14.2 + React 18.3（安定版）
サーバーコンポーネント優先（SEO最適化）
シンプルなLink実装（ネスト問題の回避）
プレーンテキストプレビュー（HTMLレンダリング最小限）
段階的な実装とビルド確認
❌ 避ける実装:
dangerouslySetInnerHTMLの多用
全ページへのedge runtime適用
Hugoコードの直接移植
Link内のLinkネスト
最新版への無計画な更新
3. 機能要件
3.1 公開サイト
トップページ（/）
最新5件の記事をカード型で表示
各カード: タイトル、作成日、要約（150文字）、タグ（最大3個）
カード全体がクリック可能（記事詳細へ遷移）
サイドバー表示
ページネーション（2ページ目以降は /?page=2）
記事詳細ページ（/[slug]）
URL例: /0050（4桁ゼロパディング連番slug）
Markdownレンダリング
見出し（H1-H6）
段落、リスト、リンク
コードブロック
画像（max-width: 100%）
ブロック引用
YouTube埋め込み: {{< youtube VIDEO_ID >}} → iframeに変換
タグ表示（クリックでタグページへ）
「← ホームに戻る」リンク
サイドバー: アーカイブで該当記事をハイライト（◉）
記事一覧ページ（/posts）
すべての記事を新しい順に表示
複数タグAND絞り込み: ?tags=tag1,tag2
キーワード検索: ?q=keyword（タイトル・本文）
ページネーション（20件/ページ）
サイドバー表示
選択中タグの表示と解除機能
タグページ（/tags/[tag]）
指定タグの記事一覧
カード型表示
サイドバー表示
検索ページ（/search?q=keyword）
キーワード検索結果
タイトル・本文からLIKE検索
カード型表示
サイドバー表示
SEO対応
/sitemap.xml: 全記事・タグページを含む動的生成
/robots.txt: クローラー制御
3.2 管理画面（/admin）
認証
方式: Basic認証
ID: mn
パスワード: 39
未認証時: 401 Unauthorized
記事一覧（/admin）
作成日降順
表示項目: ID、Slug、タイトル、タグ、作成日、操作（編集・削除）
ページネーション（20件/ページ）
新規作成（/admin/new）
タイトル入力（必須）
本文入力（Markdownテキストエリア、必須）
タグ選択（事前定義リストから複数選択可）
保存時: 自動でslugを連番割り当て（例: 0050, 0051...）
編集（/admin/edit/[id]）
既存記事の全フィールド編集可能
保存時にupdated_atを更新
削除
確認ダイアログ表示
物理削除（完全削除）
4. UIデザイン要件
レイアウト
2カラム（メイン620px + サイドバー220px、gap 20px）
max-width: 860px（中央揃え）
モバイル: 1カラム、サイドバーはハンバーガーメニューに格納
サイドバー
構成（上から順に）:
About - ブログ説明
記事一覧リンク - 「すべての記事を見る →」
アーカイブ - 年/月の階層、トグル開閉
開: ▼、閉: ▶
インデント: 年（0px）、月（15px）、記事（30px）
現在記事を◉でハイライト
Tags - タグ一覧（リンク）
カラー
ライトモード: 背景#ffffff、テキスト#333333、リンク#0066cc
ダークモード: @media (prefers-color-scheme: dark)で自動切替
アクセント: 緑系（#2d4a3a）
タイポグラフィ
フォント: 'Helvetica Neue', Arial, sans-serif
本文: 16px / 1.6
見出し: 段階的サイズ（H1:32px → H6）
レスポンシブ
デスクトップ: 2カラム
タブレット・モバイル（768px以下）: 1カラム、ハンバーガーメニュー
スクロールトップボタン（↑、右下固定）
5. データ仕様
postsテーブル
CREATE TABLE IF NOT EXISTS posts (  id INTEGER PRIMARY KEY AUTOINCREMENT,  slug TEXT NOT NULL UNIQUE,  title TEXT NOT NULL,  content TEXT NOT NULL,  tags TEXT NOT NULL DEFAULT '[]',  created_at TEXT NOT NULL,  updated_at TEXT NOT NULL);CREATE INDEX idx_posts_slug ON posts(slug);CREATE INDEX idx_posts_created_at ON posts(created_at DESC);
Postオブジェクト（TypeScript）
interface Post {  id: number  slug: string  title: string  content: string  tags: string[]  created_at: string  updated_at: string}
6. API仕様
GET /api/posts
クエリパラメータ:
limit: 件数（デフォルト20）
tag: タグ名（1つ）
search: 検索キーワード
レスポンス:
{ "posts": Post[] }
GET /api/posts/[id]
レスポンス:
{ "post": Post }
POST /api/posts（Basic認証必須）
リクエスト:
{ "title": string, "content": string, "tags": string[] }
レスポンス:
{ "post": Post }
PUT /api/posts/[id]（Basic認証必須）
リクエスト:
{ "title": string, "content": string, "tags": string[] }
DELETE /api/posts/[id]（Basic認証必須）
レスポンス:
{ "success": boolean }
7. 実装の優先順位
P0（必須・最優先）
D1データベース接続
トップページ（記事一覧5件）
記事詳細ページ
基本的なスタイリング
リンクが完全に動作すること
P1（重要）
記事一覧ページ（/posts）
タグ絞り込み・検索
サイドバー（アーカイブ、タグ）
管理画面（CRUD）
P2（あれば良い）
モバイル最適化
ダークモード
スクロールトップボタン
アクセス解析
8. 成功基準
必須条件
✅ すべてのリンクが正常に動作する
✅ Cloudflare Pagesにデプロイ成功
✅ D1データベースへの読み書きが安定動作
✅ ページ遷移が高速（<1秒）
✅ モバイルでも表示崩れなし
品質基準
ビルドエラー: 0件
Reactエラー: 0件
リントエラー: 0件（警告は許容）
LCP: <2.5秒
全主要ブラウザで動作確認
この要件定義書を保存して、実装を開始してよろしいですか？
